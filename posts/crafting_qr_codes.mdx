---
subtitle: Let's do bad things and get away with it
posted: 2024-7-12
---

import { Sa } from "../components/mdx"
import {QrTutorial} from "../components/QrTutorial"

UNFINISHED

// TODO

// finish lit review

// actually show my qr codes


QR codes are the bridge between the physical world and the internet. For this reason, they are vital to traditional advertisers, those sick bastards. Originally created as a high capacity barcode for automobile parts, QR codes now grace the covers of... literally everything. Yet despite a massively successful career switch, they carry unmistakable signs of their original purpose.

{
<div className="grid rows-[min-content_1fr_min-content] cols-2 grid-flow-col gap-x-4 font-thin text-sm text-center">
  <div className="font-semibold text-lg">QR codes in the wild</div>
  <img src="rush_hour.jpg" alt="rush hour in train station where salarymen have qr code faces"/>
  <span>
    <Sa href="https://commons.wikimedia.org/wiki/File:Just_going_to_work_(3509126762).jpg">Original photo</Sa> by <Sa href="https://www.flickr.com/people/erikjohansson78/">erikjohansson</Sa>, <Sa href="https://creativecommons.org/licenses/by/2.0/deed.en">CC BY 2.0</Sa>
  </span>
  <div className="font-semibold text-lg">Me writing this blog post</div>
  <img src="train_escape.jpg" alt="me escaping from a train full of salarymen with qr code faces"/>
  <span>
  <Sa href="https://www.flickr.com/photos/19736899@N04/2046534730">Original photo</Sa> by <Sa href="https://www.flickr.com/people/hern42/">Arnaud DG</Sa>, <Sa href="https://creativecommons.org/licenses/by/2.0/deed.en">CC BY 2.0</Sa>
  </span>
</div>
}

To be clear, there is nothing wrong with a plain, black and white, 2D barcode that links to extra product details or food nutrition facts.

But equally clearly, aesthetics matter. Some companies have even gone so far as to develop proprietary scannable codes to maintain their brand identity

![four proprietary scan codes](four_horsemen.png)

But even for billion dollar companies, non-QR codes are relegated to the position of party trick. Tiktok and Snapchat have already replaced their custom codes with stylized QR codes, and we, the non-billion dollar non-companies, stand even less chance at using something custom because a scannable code that can only be scanned inside a specific app is hardly "scannable" at all.

We cannot make beautiful codes scannable. We must make QR codes beautiful.

![qr code crafting recipe](crafting_recipe.jpg)

## The Story Before the Recipe

Around 2 years ago, I had the idea to draw QR codes with chalk on sidewalks using a giant stencil. I had just learned that QR codes have built in error correction capabilities, and it seemed like the perfect complement to those sidewalk chalk advertisements I saw on campus.

{
  <div className="grid cols-2 gap-4 font-thin text-sm text-center">
    <div>
      <img src="stencil_1.jpg" alt="bad qr code stencil"/>
      A terrible first attempt
    </div>
    <div>
      <img src="stencil_2.jpg" alt="slightly better qr code stencil"/>
      Improved but still nearly unscannable
    </div>
  </div>
}

TLDR; this worked poorly for several reasons. Chalk smears easily, has bad contrast, is painfull slow to fill in, and higher error correction requires larger QR codes with smaller pixels. 

But, while designing those stencils, I did end up learning a little about how QR codes works.

There are **finder patterns** in 3 corners.

<QrTutorial/>

## The State of QR Codes

At the start of this year, I started building a [basic QR code generator](https://github.com/zhengkyl/fuqr) for fun and to get more practice with Rust (i use windows btw).

I also built [a web app to quickly iterate and preview QR code designs](https://github.com/zhengkyl/qrframe). It uses my Rust library via WASM, and it's way faster to iterate with. It comes with a code editor that directly runs code in your browser to render onto a canvas. It has no safeguards or sandboxing, so please don't self-XSS yourself by pasting unknown code. Though if you do, just close the tab.

I'm using it to craft QR codes that look like this.
When I go out to eat, and when I open my pantry. When I browse books at the library, and when I close my eyes to embrace sleep. They stare at me with square eyes and a TV static face, as if I were an overworked Japanese salaryman in a world where faces are censored with QR codes.




I took some photos of QR codes that caught my eye on a trip to San Francisco this summer.

Here are some that shocked me in some way or another.

{
<div className="grid cols-3 gap-4 font-thin text-sm text-center">
  <div>
    <img src="sf_ad.jpg" alt="double qr codes on beer ad"/>
    Using two QR codes for a different shape. First time I've seen it.
  </div>
  <div>
    <img src="sf_book.jpg" alt="qr code on book cover"/>
    Unscannable book cover. I cracked it and found the <Sa href="https://www.istockphoto.com/vector/qr-code-gm156283521-15512938">original stock image</Sa> by <Sa href="https://www.istockphoto.com/portfolio/Oehoeboeroe">Oehoeboeroe</Sa>. 
  </div>
  <div>
    <img src="sf_logo.jpg" alt="qr code shaped like logo"/>
    Incorporated into the restaurant logo.
  </div>
</div>
}

And here are some good QR codes that I saw.

{
<div className="grid cols-2 sm:cols-4 gap-4 font-thin text-sm text-center">
  <div>
    <img src="sf_insta.jpg" alt="instagram qr code"/>
    Instagram's official QR code generator
  </div>
  <div>
    <img src="sf_uber.jpg" alt="circular uber flowcode qr code"/>
    Uber advertisement inside airport
  </div>
  <div>
    <img src="sf_maven.jpg" alt="maven retail qr code"/>
    Real estate property information
  </div>
  <div>
    <img src="sf_servy.jpg" alt="servy mobile ordering qr code"/>
    Promoting mobile ordering on ordering kiosk
  </div>
</div>
}

Notice how they all look like a QR code, but are distinct in a way that fits their brand identity.

If you want to see some counterexamples, all the pictures I took are available at https://photos.app.goo.gl/mXLhxVieRw72iCJt7.

## Legal operations

Besides the error correction, based on Reed-Solomon codes, used to encode the data (as well as the format and version metadata), QR codes are robust to a variety of simple transformations.

There is no limit on the color of the pixels as long as their is sufficient contrast between dark and light pixels. The "dark" and "light" pixels can also be inverted, which you've probably often seen already.

It may seem obvious, but QR codes can be rotated any which way. Less obvious is the fact that they can be mirrored as well. This makes it possible to make interesting symmetric designs using multiple QR codes.

## Prior work
// TODO burger king

Here is a brief and incomplete overview of ways people have tried to subvert QR codes.

[Russ Cox, QArt Codes](https://research.swtch.com/qart)
By encoding arbitrary numbers in an ignored url anchor, images can be placed into the QR code without relying on error correction.

[Halftone QR Codes](https://cgv.cs.nthu.edu.tw/projects/Recreational_Graphics/Halftone_QRCodes)
This process involves replacing each QR code pixel with a 3x3 grid of pixels that best match the image while still decoding as the correct color. Also, by introducing a limited number of errors, they can further enhance visual quality in key areas.

A simpler approach involves overlaying a QR code with smaller data pixels on top of a background image so that only the center of each QR code pixel is the correct color.

[Lachlan Arthur](https://github.com/lachlanarthur)'s [original JSFiddle implementaion](https://jsfiddle.net/lachlan/r8qWV/) which inspired [Jason Butler](https://github.com/nythrox)'s [Halftone QR Code Generator](https://github.com/nythrox/halftone-qrcode) and [Roman Tsukanov](https://github.com/gentlecat)'s [Halftone QR Code Generator](https://qr.roman.zone).

[Bad Apple but it is played with QR code](https://www.youtube.com/watch?v=tPYUdjptMpk)

[Amazing-QR](https://github.com/x-hw/amazing-qr)
Supports color and GIFs.

[vCode](https://github.com/ruitaocc/vCode)
Uses color thresholds to reduce number and intensity of overlayed pixels.

[QRpicture](https://github.com/xyzzy/qrpicture)
Uses color quantization and a high-contrast color palette to maximize scannability of color images. Really good at hiding the QR code's noisy "texture".

[Micrography QR Codes](https://github.com/DiscreteKat/MicrographyQRCodes)
The weirdest of the bunch, but super cool.

Tangent -> Creating QR code that matches a string
https://marienraat.nl/hacking-qr-codes.html

[Troy Ni (@ciaochaos)](https://github.com/ciaochaos) created QRBTF, a generator used to create truly beautiful QR codes like the ones below. The original inspiration is detailed in [this blog post](https://troyni.com/articles/building-qrbtf-zh).

{
  <div className="grid cols-2 gap-4">
    <img src="qrbtf_blocks.svg" alt="bad qr code stencil"/>
    <img src="qrbtf_alien.svg" alt="slightly better qr code stencil"/>
  </div>
}

Perhaps unsuprisingly, they also created the first AI QR codes, which they documented in [this blog post](https://troyni.com/articles/qrcode-controlnet-zh).

Following that, Anthony Fu ([@antfu](https://github.com/antfu)) made a series of blog posts detailing his experiments ([first](https://antfu.me/posts/ai-qrcode), [second](https://antfu.me/posts/ai-qrcode-refine)), culiminating in a definite guide https://antfu.me/posts/ai-qrcode-101 co-authored by [赛博迪克朗](https://space.bilibili.com/339984/), wangcai, and [代々木](https://www.xiaohongshu.com/user/profile/5be8fb806b58b745447aab0f).


## What's the deal with QR codes?

There's a 100 page PDF describing the QR code standard (ISO/IEC 18004) in detail, but here's the truth.

A QR code is whatever a QR code scanner can scan.

Here are some undocumented behaviors I discovered while making [a simple QR code generator](https://github.com/fuqr).

- UTF-8 is implicitly supported when using the byte encoding mode.
- Kanji, Structured append, EC1, and FNC1 encoding modes aren't relevant for normal use. Scanners might not even support them (I can't find generators that support them either).

Oversimplifiying to the point of misinformation, there are 2\* parts of a QR code decoder we need to swindle.

- A QR code detector (based on computer vision) gets a bounding box
- A binarizer algorithm converts an image to a matrix of on/off bits

We can do anything to a QR code as long as those two parts still function mostly correctly.

Google's scanner is part of their MLKit.
Apple's is part of their AVFoundation.

Neither implementation has available source code, not that it would do us much good.

Thankfully, the Wechat scanner is seemingly open source. It's available as an OpenCV extension. It's a fork of the cpp port of the popular zxing library.
