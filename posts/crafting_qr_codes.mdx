---
posted: 2024-9-12
desc: How they work and how to make them pretty
image: crafting.jpg
---

import { Sa } from "../components/mdx"
import { QrTutorial } from "../components/QrTutorial"

QR codes have invaded our world.

Their prolific penetration is no surprise. They store information efficiently, scan fast and reliably, and now that QR code scanning capabilities are built-in on phone cameras, there is nothing that even comes close to their convenience.

They are simply irreplaceable to *anyone looking to share a URL* (read: everyone).

Suffice it to say, I've seen a few QR codes in my day to day.

{
<div className="grid rows-[min-content_1fr_min-content] cols-2 grid-flow-col gap-x-4 font-thin text-xs text-center">
  <div className="font-semibold text-lg">Me Writing this Blog Post</div>
  <img src="train_escape.jpg" alt="me escaping from a train full of salarymen with qr code faces"/>
  <span>
  <Sa href="https://www.flickr.com/photos/19736899@N04/2046534730">Original photo</Sa> by <Sa href="https://www.flickr.com/people/hern42/">Arnaud DG</Sa>, <Sa href="https://creativecommons.org/licenses/by/2.0/deed.en">CC BY 2.0</Sa>
  </span>
  <div className="font-semibold text-lg">The Observable Universe</div>
  <img src="rush_hour.jpg" alt="rush hour in train station where salarymen have qr code faces"/>
  <span>
    <Sa href="https://commons.wikimedia.org/wiki/File:Just_going_to_work_(3509126762).jpg">Original photo</Sa> by <Sa href="https://www.flickr.com/people/erikjohansson78/">erikjohansson</Sa>, <Sa href="https://creativecommons.org/licenses/by/2.0/deed.en">CC BY 2.0</Sa>
  </span>
</div>
}

With how widespread they are in consumer facing spaces like advertising, it's also no suprise that companies would want to brand their QR codes. The most common practice is placing a logo in the center, which relies on error correction to recover the missing data. 

{
  <div className="grid cols-2 sm:cols-4 gap-2">
    <img src="logo/in_mcdonalds.jpg" alt="mcdonalds app"/>
    <img src="logo/sf_uber.jpg" alt="uber ad"/>
    <img src="logo/duolingo.jpg" alt="duolingo profile"/>
    <img src="logo/instagram.svg" alt="instagram profile"/>
  </div>
}

Beyond simply placing a logo on top, there have been many attempts to create "artistic" QR codes, which use the entire code as a canvas. Some techniques use the pixel grid, some work around it, while more recent developments involve using generative AI to create scannable anime women.

{
  <div className="grid cols-2 sm:cols-4 gap-2 font-thin text-xs text-center pixelated">
    <div>
      <img src="image/qart_go.png" alt="golang mascot qart code"/>
      <Sa href="https://research.swtch.com/qart">QArt Codes</Sa>
    </div>
    <div>
      <img src="image/halftone_einstein.png" alt="halftone einstein qr code"/>
      <Sa href="https://cgv.cs.nthu.edu.tw/projects/Recreational_Graphics/Halftone_QRCodes">Halftone QR Codes, 2013</Sa>
    </div>
    <div>
      <img src="image/overlay_burger_king.jpg" alt="burger king ad qr code"/>
      <Sa href="https://www.youtube.com/watch?v=hnYXq1oyi2g">Burger King VMA Commercials</Sa>
    </div>
    <div>
      <img src="image/ai_anime.jpg" alt="ai generated anime qr code"/>
      AI generated using <Sa href="https://qrbtf.com">QRBTF</Sa>
    </div>
  </div>
}

While limited, these techniques are not specific to a single QR code and generalize to any image and URL. This is in stark contrast to the labor intensive but fully bespoke QR codes made by human designers.

{
  <div className="grid cols-2 sm:cols-4 gap-2 font-thin text-xs text-center pixelated">
    <div>
      <img src="bespoke/qrcanvas.jpg" alt="qrcanvas"/>
      <Sa href="https://qrcanvas.nl">QRcanvas</Sa>
    </div>
    <div>
      <img src="bespoke/amicollective.png" alt="amicollective"/>
      <Sa href="https://www.behance.net/gallery/3702490/CALENDAR">2012 MTS Calendar</Sa> <span className="whitespace-pre">Am I Collective</span> (<Sa href="https://thedsgnblog.tumblr.com/post/32805738545/am-i-collective-httpamicollectivecom">source</Sa>)
    </div>
    <div>
      <img src="bespoke/minor.png" alt="minor"/>
      minor<br/>
      (<Sa href="https://dribbble.com/minorart/shots">Dribbble</Sa>, <Sa href="https://www.behance.net/739019620c2bc">Behance</Sa>)
    </div>
    <div>
      <img src="bespoke/elkoy.png" alt="elkoy artists collective"/>
      <Sa href="https://art-qrcode.com/">The Art of QR Codes / <span className="whitespace-pre">Elkoy Artists</span> Collective</Sa>
    </div>
  </div>
}

{
  <small className="text-stone-700">
    These were suprisingly hard to find. I started from this <Sa href="https://www.flickr.com/groups/qr-art/pool/page1">Flickr group</Sa> featuring QR code art from the early 2010's, but Pinterest proved an invaluable resource that surfaced obscure work from Behance, Dribbble, and random blogs.
  </small>
}

Where does this leave us if we want a unique QR code, but we don't want to design each one from scratch for every URL?

I'm not exactly a designer, but <Sa href="https://troyni.com/articles/building-qrbtf-zh">this blog post</Sa> from the creator of <Sa href="https://qrbtf.com">QRBTF</Sa> convinced me that QR code generators *can* create beautiful QR codes. So I got inspired by stained glass, Persian rugs, comic books, and retro logos, and locked in for minutes at a time between months of procrastination.

{
  <div className="grid cols-2 sm:cols-4 gap-2">
    <img src="qrframe/stained_glass.svg" alt="stained glass"/>
    <img src="qrframe/quantum.svg" alt="physics"/>
    <img src="qrframe/whiteboard.png" alt="whiteboard marker"/>
    <img src="qrframe/neon.svg" alt="neon sign"/>
    <img src="qrframe/layers.svg" alt="layered patterns"/>
    <img src="qrframe/tile.png" alt="bathroom tile"/>
    <img src="qrframe/dots.svg" alt="benday dots"/>
    <img src="qrframe/mondrian.svg" alt="abstract art"/>
  </div>
}

The end result is https://qrframe.kylezhe.ng, a web app that lets you define parameters and write code to render QR codes however you want. Here's the [source code](https://github.com/zhengkyl/qrframe) for the perverts.

It comes with many example presets, based on existing styles and my original designs, which I hope others can use and build upon to create their own custom QR codes.

Feel free to play with it, but in order to craft QR codes with intention, we need to learn how QR codes *actually* work.

## How do QR codes work?

Around few years ago, I had the idea to draw QR codes using chalk and a stencil.

{
  <div className="grid cols-2 gap-4 font-thin text-xs text-center">
    <div>
      <img src="stencil_1.jpg" alt="bad qr code stencil"/>
      My terrible first attempt
    </div>
    <div>
      <img src="stencil_2.jpg" alt="slightly better qr code stencil"/>
      Improved but still nearly unscannable
    </div>
  </div>
}

This was a failure for many reasons (it takes forever to draw and smears instantly), but the biggest issue was that the end result couldn't be scanned.

I failed because I didn't understand two important things.

1. Smartphone camera apps are not dedicated QR code scanners. They don't even attempt to scan until after a QR code is detected by a computer vision model. I *suspect* they favor solid colors and high contrast, and my chalk didn't contrast enough against or completely cover the gray concrete. This is (probably) also why some "artistic" QR codes scan better from farther away; the pixel colors are more solid on a smaller image.

2. The finder patterns have to be somewhat precise for decoding to succeed

<QrTutorial/>

These are not explicitly supported, but it's pretty hard to make a working QR code scanner that doesn't also scan these artistically disfigured QR codes. 



## Prior work

One way to add an image is to manipulate the input data.

For URL's specifically, arbitrary data can be added as an ignored URL anchor. This data can be calculated to precisely manipulate pixels in the QR code in limited areas. This approach doesn't rely on error correction at all, but it is limited in the images it can create ([Russ Cox, QArt Codes](https://research.swtch.com/qart)).

{
  <div className="grid cols-2 font-thin text-xs text-center pixelated">
    <div>
      <img src="qart_go.png" alt="golang mascot qart code"/>
      Go Gopher from <Sa href="https://research.swtch.com/qart">QArt Codes</Sa>
    </div>
    <div>
      <img src="qart_mike.png" alt="mike wazowski qart code"/>
      Created using <Sa href="https://research.swtch.com/qr/draw/">QArt Coder</Sa>
    </div>
  </div>
}

A more common approach is to change how each QR code pixel is represented.

One strategy, possibly popularized by the [Halftone QR Codes](https://cgv.cs.nthu.edu.tw/projects/Recreational_Graphics/Halftone_QRCodes) paper, involves replacing each QR code pixel with a 3x3 grid of pixels that best match the image while still decoding as the correct color.

{
  <div className="grid cols-2 font-thin text-xs text-center pixelated">
    <div>
      <img src="halftone_albert.png" alt="halftone einstein qr code"/>
      Example from <Sa href="https://cgv.cs.nthu.edu.tw/projects/Recreational_Graphics/Halftone_QRCodes">Halftone QR Codes, 2013</Sa>
    </div>
    <div>
      <img src="halftone_mike.png" alt="halftone mike wazowski qr code"/>
      Created using <Sa href="https://qrframe.kylezhe.ng">qrframe</Sa>
    </div>
  </div>
}

Generally, as long as the center of each QR code pixel is correct, it can be decoded correctly. In other words, this approach is basically equivalent to overlaying the correct center pixels on top of a image. 

The low resolution black and white dithered effect is just a smart stylistic choice that hides the data as noise. There are many implementations online [^1] as well as a version of [Bad Apple](https://www.youtube.com/watch?v=tPYUdjptMpk).


[^1]: [Lachlan Arthur](https://github.com/lachlanarthur)'s [original JSFiddle implementaion](https://jsfiddle.net/lachlan/r8qWV/) 

    [Jason Butler](https://github.com/nythrox)'s [Halftone QR Code Generator](https://github.com/nythrox/halftone-qrcode)

    [Roman Tsukanov](https://github.com/gentlecat)'s [Halftone QR Code Generator](https://qr.roman.zone).

Moreover, the image doesn't have to be black and white or low resolution at all.

{
  <div className="grid cols-2 font-thin text-xs text-center">
    <div>
      <img src="bk.jpg" alt="burger king ad qr code"/>
      <Sa href="https://www.youtube.com/watch?v=hnYXq1oyi2g">Burger King VMA Commercials</Sa>
    </div>
    <div>
      <img src="visualead_mike.jpg" alt="visualead qr code"/>
      Created using <Sa href="https://github.com/x-hw/amazing-qr">Visualead</Sa>
    </div>
  </div>
}

A more subtle effect can be achieved by only adjusting the image color 
[vCode](https://github.com/ruitaocc/vCode)
Uses color thresholds to reduce number and intensity of overlayed pixels.

[QRpicture](https://github.com/xyzzy/qrpicture)
Uses color quantization and a high-contrast color palette to maximize scannability of color images. Really good at hiding the QR code's noisy "texture".
{
  <div className="grid cols-2 font-thin text-xs text-center">
    <div>
      <img src="amzqr_mike.jpg" alt="color image qr code"/>
      Created using <Sa href="https://github.com/x-hw/amazing-qr">Amazing-QR</Sa>
    </div>
    <div>
      <img src="qrpicture.jpg" alt="mike wazowski qr picture"/>
      Created using <Sa href="https://qrpicture.com">QRpicture</Sa>
    </div>
  </div>
}

{
  <div className="grid cols-2 font-thin text-xs text-center">
    <div>
      <img src="qrpicture.gif" alt="animated qr picture"/>
      Example from <Sa>https://github.com/xyzzy/qrpicture</Sa>
    </div>
    <div>
      <img src="micro_mike.jpg" alt="mike wazowski micrography qr"/>
      Example from <Sa href="https://cgv.cs.nthu.edu.tw/projects/Recreational_Graphics/MQRC">Micrography QR Codes</Sa>
    </div>
  </div>
}
[Micrography QR Codes](https://github.com/DiscreteKat/MicrographyQRCodes)
The weirdest of the bunch, but super cool.

Perhaps unsuprisingly, they also created the first AI QR codes, which they documented in [this blog post](https://troyni.com/articles/qrcode-controlnet-zh).

Following that, Anthony Fu ([@antfu](https://github.com/antfu)) made a series of blog posts detailing his experiments ([first](https://antfu.me/posts/ai-qrcode), [second](https://antfu.me/posts/ai-qrcode-refine)), culiminating in a definite guide https://antfu.me/posts/ai-qrcode-101 co-authored by [赛博迪克朗](https://space.bilibili.com/339984/), wangcai, and [代々木](https://www.xiaohongshu.com/user/profile/5be8fb806b58b745447aab0f).

{
  <div className="grid cols-2 font-thin text-xs text-center">
    <div>
      <img className="p4" src="ai_anime.jpg" alt="ai generated anime qr code"/>
      AI generated using <Sa href="https://qrbtf.com">QRBTF</Sa>
    </div>
    <div>
      <img className="p4" src="ai_mike.jpg" alt="ai generated mike wazowski qr code"/>
      AI generated using <Sa href="https://qrbtf.com">QRBTF</Sa>
    </div>
  </div>
}

Try moving your phone away from the screen (farther than you think), and maybe increase your brightness.

 Here's the [original blog post in Chinese](https://troyni.com/articles/qrcode-controlnet-zh) as well as a more [complete guide](https://antfu.me/posts/ai-qrcode-101) if you're interested in that.


[Troy Ni (@ciaochaos)](https://github.com/ciaochaos) created QRBTF, a generator used to create truly beautiful QR codes like the ones below. The original inspiration is detailed in [this blog post]().

{
  <div className="grid cols-2 font-thin text-xs text-center">
    <div>
    <img src="qrbtf_blocks.svg" alt="color blocks qr code"/>
      Created using <Sa href="https://qrbtf.com">QRBTF</Sa>
    </div>
    <div>
    <img src="qrbtf_alien.svg" alt="alien goo qr code"/>
      Created using <Sa href="https://qrbtf.com">QRBTF</Sa>
    </div>
  </div>
}

## Tangents

Tangent -> Creating QR code that matches a string
https://marienraat.nl/hacking-qr-codes.html
There's a 100 page PDF describing the QR code standard (ISO/IEC 18004) in detail, but here's the truth.

A QR code is whatever a QR code scanner can scan.

Here are some undocumented behaviors I discovered while making [a simple QR code generator](https://github.com/fuqr).

- UTF-8 is implicitly supported when using the byte encoding mode.
- Kanji, Structured append, EC1, and FNC1 encoding modes aren't relevant for normal use. Scanners might not even support them (I can't find generators that support them either).

Oversimplifiying to the point of misinformation, there are 2\* parts of a QR code decoder we need to swindle.

- A QR code detector (based on computer vision) gets a bounding box
- A binarizer algorithm converts an image to a matrix of on/off bits

We can do anything to a QR code as long as those two parts still function mostly correctly.

Google's scanner is part of their MLKit.
Apple's is part of their AVFoundation.

Neither implementation has available source code, not that it would do us much good.


Whether it's an app with a shareable code, an advertisement meant to catch your eye, or someone with too much time, the possibilities of beautiful QR codes awaits.

The QR code standard (ISO/IEC 18004) suggests how a QR code can be created and decoded. It is up to the QR code scanner to convert an image into this decodable 2d matrix of black and white pixels. This makes everything possible.

Thankfully, the Wechat scanner is seemingly open source. It's available as an OpenCV extension. It's a fork of the cpp port of the popular zxing library.


I found this book in a random library I stopped in. Too much of the QR code was missing for it to scan, but I thought it might contain an Easter egg. I used [QRazyBox](https://merri.cx/qrazybox/) to recover what data remained which was only about half the URL. This was the first strange finding. The code was almost entirely padding! The error correction was set to low too! Why wasn't the error correction set higher if the space was all wasted? 

![qr code on book cover](sf_book.jpg)

Using an ASCII chart to decode some partially obscured bytes, I figured out it pointed to an iStockphoto page, but unfortunately iStockphoto had changed their URL structure. I had what looked like half a username, but there was no way to search for users. With no other option, I brute-forced all 80,000 possible QR codes and compared the error correction pixels to find a match. I was shocked to find nothing. In a desperate last try, I checked for near matches and finally found the matching username which led me to the [original stock image from 2011](https://www.istockphoto.com/vector/qr-code-gm156283521-15512938).

It turns out the QR code incorrectly has a last byte filled with 1s instead of 0s.

Why was this used for the book cover? The book came out in 2021. Did the designer just have it on hand? Even though they could just get a QR code from anywhere? I guess it didn't matter, because who would notice? Kind of an anticlimax, but my takeaway is that damaged QR codes are probably all decodable with effort.

[^1]: My reference.

Some companies have even gone so far as to develop proprietary scannable codes to maintain their brand identity, to varying success[^scannable-codes].

[^scannable-codes]: Tiktok and Snapchat have already replaced their custom codes with stylized QR codes.

![four proprietary scan codes](four_horsemen.png)

Notice how they're all mostly gimmicks since they can only be scanned with a specific app (or device).